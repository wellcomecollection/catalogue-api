{
  "bool": {
    "should": [
      {
        "span_first": {
          "match": {
            "span_term": {
              "query.title.shingles": "{{query}}"
            }
          },
          "end": 1,
          "boost": 1000,
          "_name": "start of title"
        }
      },
      {
        "multi_match": {
          "query": "{{query}}",
          "fields": [
            "query.id^1000.0",
            "query.identifiers.value^1000.0",
            "query.items.id^1000.0",
            "query.items.identifiers.value^1000.0",
            "query.images.id^1000.0",
            "query.images.identifiers.value^1000.0",
            "query.referenceNumber^1000.0"
          ],
          "type": "best_fields",
          "analyzer": "whitespace_analyzer",
          "operator": "Or",
          "_name": "identifiers"
        }
      },
      {
        "dis_max": {
          "queries": [
            {
              "multi_match": {
                "query": "{{query}}",
                "fields": [
                  "query.title^100.0",
                  "query.title.english^100.0",
                  "query.title.shingles^100.0",
                  "query.alternativeTitles^100.0",
                  "query.alternativeTitles.english^100.0",
                  "query.alternativeTitles.shingles^100.0",
                  "query.contributors.agent.label^100.0",
                  "query.contributors.agent.label.english^100.0",
                  "query.contributors.agent.label.shingles^100.0"
                ],
                "type": "best_fields",
                "operator": "And",
                "_name": "title and contributor exact spellings"
              }
            },
            {
              "multi_match": {
                "query": "{{query}}",
                "fields": [
                  "search.title.arabic",
                  "search.title.bengali",
                  "search.title.french",
                  "search.title.german",
                  "search.title.hindi",
                  "search.title.italian",
                  "search.alternativeTitles.arabic",
                  "search.alternativeTitles.bengali",
                  "search.alternativeTitles.french",
                  "search.alternativeTitles.german",
                  "search.alternativeTitles.hindi",
                  "search.alternativeTitles.italian",
                  "search.contributors.agent.label.arabic",
                  "search.contributors.agent.label.bengali",
                  "search.contributors.agent.label.french",
                  "search.contributors.agent.label.german",
                  "search.contributors.agent.label.hindi",
                  "search.contributors.agent.label.italian"
                ],
                "type": "best_fields",
                "operator": "And",
                "_name": "non-english titles and contributors"
              }
            }
          ]
        }
      },
      {
        "bool": {
          "should": [
            {
              "multi_match": {
                "query": "{{query}}",
                "fields": ["query.title^100.0", "query.description^10.0"],
                "type": "cross_fields",
                "operator": "Or",
                "_name": "relations text"
              }
            }
          ],
          "must": [
            {
              "multi_match": {
                "fields": [
                  "query.collectionPath.path.clean",
                  "query.collectionPath.label.cleanPath",
                  "query.collectionPath.label",
                  "query.collectionPath.path.keyword"
                ],
                "query": "{{query}}",
                "operator": "Or",
                "_name": "relations paths"
              }
            }
          ]
        }
      },
      {
        "multi_match": {
          "query": "{{query}}",
          "fields": [
            "query.contributors.agent.label^1000.0",
            "query.subjects.concepts.label^10.0",
            "query.genres.concepts.label^10.0",
            "query.production.label^10.0",
            "query.description",
            "query.physicalDescription",
            "query.languages.label",
            "query.edition",
            "query.notes.contents",
            "query.lettering"
          ],
          "type": "cross_fields",
          "operator": "And",
          "_name": "data"
        }
      }
    ],
    "filter": [
      {
        "term": {
          "type": {
            "value": "Visible"
          }
        }
      }
    ],
    "minimum_should_match": "1"
  }
}
